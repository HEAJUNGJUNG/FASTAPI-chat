# ==========================
# FastAPI PowerShell Runner
# ==========================
# ìë™ ê°€ìƒí™˜ê²½ í™œì„±í™” + Uvicorn ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
# ì‘ì„±ì: í˜œì • ì „ìš© Dev Setup

# --- [1] ê²½ë¡œ ì„¤ì • ---
$projectRoot = Split-Path -Parent $MyInvocation.MyCommand.Path
Set-Location $projectRoot

# --- [2] ê°€ìƒí™˜ê²½ ê²½ë¡œ í™•ì¸ ---
$venvPath = Join-Path $projectRoot "venv\Scripts\Activate.ps1"
if (-Not (Test-Path $venvPath)) {
    Write-Host "âš ï¸  ê°€ìƒí™˜ê²½(venv)ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤..." -ForegroundColor Yellow
    python -m venv venv
}

# --- [3] ê°€ìƒí™˜ê²½ í™œì„±í™” ---
Write-Host "ğŸ ê°€ìƒí™˜ê²½ í™œì„±í™” ì¤‘..." -ForegroundColor Cyan
& $venvPath

# --- [4] ì˜ì¡´ì„± í™•ì¸ (ì—†ìœ¼ë©´ ìë™ ì„¤ì¹˜) ---
if (-Not (Test-Path "$projectRoot\venv\Lib\site-packages\fastapi")) {
    Write-Host "ğŸ“¦ FastAPI, Uvicorn ë“± ì˜ì¡´ì„± ì„¤ì¹˜ ì¤‘..." -ForegroundColor Yellow
    pip install fastapi uvicorn sqlalchemy pydantic python-jose passlib[bcrypt]
}

# --- [5] ì„œë²„ ì‹¤í–‰ ---
Write-Host "ğŸš€ FastAPI ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤..." -ForegroundColor Green
try {
    python -m uvicorn app.main:app --reload
}
catch {
    Write-Host "âŒ ì„œë²„ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:" $_.Exception.Message -ForegroundColor Red
}

# --- [6] ì¢…ë£Œ ì‹œ ---
Write-Host "ğŸ›‘ ì„œë²„ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê°€ìƒí™˜ê²½ì„ ë¹„í™œì„±í™”í•©ë‹ˆë‹¤." -ForegroundColor DarkYellow
deactivate
