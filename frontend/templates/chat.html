<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>FASTAPI CHAT</title>
  <link rel="stylesheet" href="/static/chat.css">
</head>
<body>
  <header>
    <div>ğŸ’¬ Chat Room #1</div>
    <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
  </header>

  <div id="chat-box"></div>

  <div id="input-box">
    <input id="input" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off" />
    <button id="send" onclick="sendMessage()">ì „ì†¡</button>
  </div>

  <script>
	const token = localStorage.getItem("token");
	const username = localStorage.getItem("username") || "ìµëª…";

	const ws = new WebSocket(`ws://${location.host}/chat/ws/room1?token=${token}`);

	ws.onmessage = (event) => {
	  const data = JSON.parse(event.data);
	  const chatBox = document.getElementById("chat-box");

	  const msgDiv = document.createElement("div");
	  msgDiv.classList.add("message");

	  // âœ… ë‚´ê°€ ë³´ë‚¸ ë©”ì‹œì§€ì¸ì§€ ë¹„êµ
	  if (data.username === username) {
		msgDiv.classList.add("mine");
	  } else {
		msgDiv.classList.add("yours");
	  }

	  const userLabel = document.createElement("div");
	  userLabel.classList.add("username");
	  userLabel.innerText = data.username || "ìµëª…";

	  const text = document.createElement("div");
	  text.classList.add("text");
	  text.innerText = data.message;

	  msgDiv.appendChild(userLabel);
	  msgDiv.appendChild(text);
	  chatBox.appendChild(msgDiv);
	  chatBox.scrollTop = chatBox.scrollHeight;
	};

	// âœ… ë©”ì‹œì§€ ì „ì†¡ ì‹œ usernameë„ í¬í•¨!
	function sendMessage() {
	  const input = document.getElementById("input");
	  const msg = input.value.trim();
	  if (msg) {
		ws.send(JSON.stringify({ username: username, message: msg }));
		input.value = "";
	  }
	}
	</script>

</body>
</html>
